#include "write.hpp"
#include "delete.hpp"
#include "threadpool.hpp"
#include "read.hpp"
#include "init.hpp"
#include "heatmap.hpp"
#include "collection.hpp"

/**
 * T : 时间片数
 * M : 标签数
 * N : 磁盘数
 * V : 磁盘容量
 * G : Token数
 * K : 垃圾回收次数
 */
int T, M, N, V, G, K;
WriteList writeList;
DeleteList deleteList;
ThreadPool threadPool(4); // 创建线程池，设置线程数为4
ReadRequest readrequest;
std::vector<Disk> disk_list;
Heatmap heatmap;
Heatmap fake_heatmap;
Init init;
std::vector<std::pair<int,int>> disk_rank;
std::unordered_set<int> done_req_set;
std::unordered_map<int, std::pair<int, int>> done_req_map;

std::unordered_map<int, Object> object_list;
std::unordered_map<int, int> request_object;

std::vector<std::vector<double>> tag_request_busy_rate;
std::vector<std::vector<std::pair<int, int>>> rank;

/**
 * 垃圾处理区
 */
Collection collection;

void timestamp_action()
{
    int timestamp;
    scanf("%*s%d", &timestamp);
    printf("TIMESTAMP %d\n", timestamp);
    fflush(stdout);
}

void delete_action(int cur_time, Heatmap& heatmap)
{
    deleteList.handleDeleteRequest(disk_list, object_list, cur_time, heatmap, done_req_set, collection);
    fflush(stdout);
}

void write_action(int cur_time)
{
    writeList.handleWriteRequest(disk_list, object_list, cur_time, collection);
    fflush(stdout);
}

void initialize_action(std::vector<std::vector<int>>& tags_delete, std::vector<std::vector<int>>& tags_save, std::vector<std::vector<int>>& tags_freq, std::vector<Disk>& disk_list,int M,int N,int T,int V,std::vector<std::pair<int,int>>& disk_rank)
{   
    init.initialize(tags_delete, tags_save, tags_freq, disk_list,M,N,T,V,disk_rank);
    init.init_heatmap(heatmap, N, V/TILE_SIZE, 1);
    init.init_heatmap(fake_heatmap, N, V/TILE_SIZE, 0);
    collection.init_garbage(N);
}

void read_action(int cur_time, Heatmap& heatmap, std::unordered_map<int, Object>& object_list, Heatmap &fake_heatmap, std::vector<Disk>& disk_list, std::unordered_map<int, int> &request_object, std::vector<std::vector<std::pair<int, int>>>& rank, std::vector<int> &g) 
{
    readrequest.Read(cur_time, heatmap, object_list, disk_list, request_object, rank, tag_request_busy_rate);

    readrequest.Call_disk_read(cur_time, disk_list, object_list, heatmap, fake_heatmap, threadPool,done_req_map, g);
    
    readrequest.Output(heatmap, cur_time, object_list, request_object, done_req_set);
    
    heatmap.update_heat(readrequest.request_queue_timeout, cur_time, object_list, disk_list, request_object, threadPool, done_req_set, done_req_map);
    
    readrequest.output_timeout(request_object, object_list,heatmap, cur_time);
    
    fflush(stdout);
}

void gc_action(std::vector<Disk> &disk_list, std::unordered_map<int, Object> &object_list, int cur_time, std::vector<std::vector<std::pair<int, int>>> &rank, int K, Heatmap &heatmap) 
{    
    scanf("%*s %*s");
    if(cur_time < T)
        collection.handleGarbageRequest(disk_list, object_list, cur_time, rank, K, heatmap);
    else{
        printf("GARBAGE COLLECTION\n");
        for (int i = 0; i < disk_list.size(); ++i) {
            printf("0\n");
        }
    }



    fflush(stdout);
}

bool load_tag_request_busy_rate_from_dat(
    std::vector<std::vector<double>> &tag_request_busy_rate)
{
    tag_request_busy_rate = {
        { 0.01234567901, 0.1764705882, 0.04225352113, 0.3103448276, 0, 0, 0.2222222222, 0.2105263158, 0, 0, 0.05555555556, 0.0119047619, 0, 0.2142857143, 0.2727272727, 0 },
        { 0.01169590643, 0.18, 0.0243902439, 0.25, 0, 0.03703703704, 0.2195121951, 0.347826087, 0, 0, 0.06451612903, 0.03157894737, 0.08333333333, 0, 0.1555555556, 0 },
        { 0, 0.02666666667, 0.01315789474, 0, 0, 0, 0.02222222222, 0, 0, 0, 0, 0.0101010101, 0.01298701299, 0, 0, 0 },
        { 0.03398058252, 0.3402061856, 0.4, 0.1764705882, 0.3265306122, 0.07594936709, 0.1764705882, 0.0003088326127, 0.08527131783, 0.2857142857, 0.2110091743, 0.09278350515, 0.2658227848, 0.2692307692, 0.3387096774, 0.05555555556 },
        { 0.1151832461, 0.384, 0.7428571429, 0.640625, 0.6551724138, 0.4084507042, 0.393442623, 0, 0.4390243902, 0.7543859649, 0.3921568627, 0.3524590164, 0.6382978723, 0.5675675676, 0.5072463768, 0.1261261261 },
        { 0.0004450378282, 0.7204968944, 0.9166666667, 0.5053763441, 0.8510638298, 0.4, 0.5505617978, 0, 0.7356321839, 1, 0.6489361702, 0.7708333333, 0.776119403, 0.6111111111, 0.7368421053, 0.3 },
        { 0, 0.8901734104, 1, 0.7752808989, 1, 0.5641025641, 0.5393258427, 0, 0.8253968254, 1, 0.7768595041, 0.6776859504, 0.7931034483, 0.6153846154, 0.7586206897, 0.5435684647 },
        { 0, 0.9447513812, 1, 0.77, 1, 0.3225806452, 0.6692307692, 0, 1, 1, 0.6696428571, 0.8666666667, 0.7765957447, 0.006177325581, 0.8705035971, 0.7551724138 },
        { 0, 1, 1, 0.8672566372, 1, 0.3658536585, 0.5652173913, 0, 1, 0.01302666395, 0.7807017544, 0.8382352941, 0.8735632184, 0.002001067236, 0.8650306748, 0.8640350877 },
        { 0, 1, 1, 0.7910447761, 1, 0.5384615385, 0.6923076923, 0.0005237289501, 1, 5.023610972e-05, 0.77, 0.8181818182, 0.8857142857, 0.0007660633917, 0.7555555556, 0.8583333333 },
        { 0, 1, 1, 0.7899159664, 1, 0.7647058824, 0.7419354839, 0.0008217409168, 1, 0, 0.8453608247, 1, 0.8540145985, 0.0007282260414, 0.8445595855, 0.8127659574 },
        { 0, 0.9146341463, 1, 0.872, 1, 0.6, 0.7716049383, 0.04200281726, 1, 0, 0.8255813953, 0.8212765957, 0.8965517241, 0, 0.8595744681, 0.8253968254 },
        { 0, 0.9957805907, 1, 0.8521126761, 1, 0.5882352941, 0.869047619, 0.7647058824, 1, 0, 1, 0.3566200931, 0.8989361702, 0, 0.9166666667, 0.7412935323 },
        { 0, 0.9955947137, 1, 0.9572649573, 1, 0.4631578947, 0.9473684211, 1, 1, 0, 1, 0.1608533695, 0.9041666667, 0, 0.9054054054, 1 },
        { 0, 1, 1, 0.9196428571, 1, 0.7008547009, 0.9870967742, 0.9894736842, 1, 0, 0.9838709677, 0.07907383137, 0.9429657795, 0, 1, 0.9069767442 },
        { 0, 0.995215311, 1, 0.9435483871, 0.9874213836, 0.4854517611, 0.9345238095, 0.9882352941, 1, 0, 1, 0.02503526093, 0.9862542955, 0, 0.995, 0.9909090909 },
        { 0, 0.9857142857, 1, 1, 1, 0.3308203991, 1, 1, 0.7671840355, 0, 1, 0.003539071348, 1, 0, 0.9950248756, 0.985915493 },
        { 0, 1, 1, 1, 1, 0.1109441523, 1, 1, 0.2139800285, 0.002631290429, 0.9696969697, 0.01223168246, 0.9964664311, 0, 1, 1 },
        { 0, 1, 1, 1, 1, 0.003918076581, 0.9375, 1, 0.01344860711, 0.1311018131, 1, 0.001724323742, 1, 0, 1, 0.9848484848 },
        { 0, 1, 1, 0.4043010753, 0.9891304348, 0.001955580388, 0.9733333333, 1, 0.003783242461, 0.9699570815, 1, 0.0004676830979, 0.9961832061, 0, 1, 1 },
        { 0.0002975431438, 1, 1, 0.1869519467, 1, 0.0004582426395, 1, 1, 0.002638290388, 1, 1, 0.002257924446, 1, 3.01713734e-05, 1, 0.9387755102 },
        { 0, 1, 1, 0.05635757912, 0.9833333333, 0.0002947533897, 1, 1, 0.001177769599, 1, 1, 0.002850356295, 0.9859813084, 0, 1, 0.9571428571 },
        { 0.0006154266958, 1, 1, 0.005877293578, 1, 0.0006853422428, 0.9803921569, 1, 0, 0.9951923077, 1, 0.001425142514, 1, 4.046453284e-05, 1, 0.9431818182 },
        { 0.002957519269, 1, 1, 0.0002831056692, 1, 7.887057339e-05, 1, 1, 5.565139963e-05, 1, 1, 0.01341655905, 0.992, 0, 1, 0.7665706052 },
        { 0.07820025349, 1, 1, 0, 0.9826086957, 0.000650994575, 1, 1, 0.00300120048, 1, 1, 0.04141441937, 0.9669421488, 0, 1, 0.01616698292 },
        { 0.4041466346, 1, 1, 0, 0.9894736842, 0.0005331200853, 1, 1, 0.001100059587, 1, 1, 0.04874679297, 1, 0.001391845423, 1, 0.001471340839 },
        { 0.9943181818, 1, 0.9821428571, 5.959297995e-05, 1, 0.0009476876422, 0.9714285714, 1, 0.001539382537, 1, 0.9764705882, 0.03698674426, 1, 0.01241740715, 1, 0.001104206811 },
        { 0.9708737864, 1, 1, 7.797270955e-05, 1, 0.0002408767915, 1, 1, 0.001832023776, 1, 0.9826086957, 0.05328155834, 0.9090909091, 0.1036515474, 1, 0.0006011527989 },
        { 1, 1, 1, 0, 1, 0.0009875108917, 1, 1, 0.01342412451, 1, 1, 0.04348102069, 1, 1, 0.9887640449, 0.0005424291253 },
        { 0.9820627803, 1, 0.9166666667, 0, 0.9473684211, 0.001474842589, 1, 1, 0.02453645096, 1, 1, 0.0581575883, 0.9552238806, 1, 1, 0.0002427341576 },
        { 0.9653679654, 1, 1, 0, 0.8658618377, 0.001598412611, 1, 1, 0.01829896907, 1, 1, 0.05326537114, 0.9726027397, 0.9480519481, 1, 0.001093553502 },
        { 0.9906103286, 1, 1, 0, 0.4606403013, 0.001855388813, 1, 1, 0.0117488724, 0.9857142857, 0.9846153846, 0.07942906231, 0.8860759494, 0.9761904762, 0.9928057554, 0.003120574186 },
        { 0.9685863874, 1, 1, 0, 0.09083424808, 0.00513556795, 1, 1, 0.02707158034, 1, 1, 0.1317389542, 0.9120879121, 1, 0.9890710383, 0.0128513423 },
        { 0.9681528662, 0.9912280702, 1, 4.621606008e-05, 0.03911472001, 0.005486892424, 1, 1, 0.04289045988, 1, 0.9941860465, 0.2540188372, 0.9056603774, 0.9756097561, 0.9763313609, 0.02254853772 },
        { 1, 1, 0.96, 0, 0.02580089421, 0.001835599151, 1, 1, 0.03232654277, 0.9833333333, 0.9315068493, 0.3120473023, 0.9386503067, 1, 0.9776536313, 0.03062728613 },
        { 0.9758064516, 1, 0.92, 0.0003362663229, 0.02586052509, 0.003198483682, 1, 1, 0.09353180388, 1, 0.724671916, 0.4303596894, 0.8577981651, 0.9918699187, 0.9389671362, 0.01487913874 },
        { 0.8926615553, 1, 0.9642857143, 0.0002353099368, 0.01957970272, 0.001830719473, 1, 1, 0.117886341, 0.994047619, 0.4873652291, 0.4965274801, 0.8333333333, 0.9920634921, 0.9694323144, 0.01380680167 },
        { 0.8901158093, 1, 0.9130434783, 0, 0.02346300326, 0.004296315584, 0.9945652174, 0.9882352941, 0.09275694246, 0.9939759036, 0.2137518685, 0.3579512052, 0.9004149378, 0.9850746269, 0.9727272727, 0.01377031121 },
        { 0.916260335, 1, 1, 0.001024034697, 0.02579213504, 0.006213324128, 0.9736842105, 0.9813084112, 0.1067363888, 0.9807692308, 0.1228993723, 0.202851008, 0.859375, 1, 0.9951923077, 0.0137241536 },
        { 0.774308653, 0.9942528736, 0.9642857143, 0.0006254343294, 0.03805087191, 0.006155405895, 0.9814814815, 1, 0.1111790147, 0.9955752212, 0.1198633063, 0.2348506161, 0.8825622776, 0.9838709677, 0.9457831325, 0.010523918 },
        { 0.5122786979, 0.9651741294, 0.9726027397, 0.0001518948887, 0.05133657351, 0.01358695652, 0.9185185185, 0.9882352941, 0.1214412586, 0.9755102041, 0.07399136519, 0.1389060888, 0.8674698795, 1, 0.9371428571, 0.01218004487 },
        { 0.265431356, 0.9923664122, 0.9545454545, 0.000421798549, 0.1412191582, 0.008956010185, 0.9677419355, 1, 0.1380214269, 0.9959349593, 0.07165130152, 0.11085122, 0.9233576642, 0.989010989, 0.9183673469, 0.01062650157 },
        { 0.07024539877, 1, 0.952, 0.003769937168, 0.5619407159, 0.0200811359, 0.9655172414, 1, 0.137777491, 0.9918367347, 0.04564011943, 0.1131039685, 0.9047619048, 0.9724770642, 0.8636363636, 0.008202357564 },
        { 0.0461130742, 0.9888888889, 0.9357798165, 0.00363356089, 0.903500473, 0.01670445054, 0.9714285714, 0.5509583207, 0.1561349463, 0.9868995633, 0.03367429031, 0.1077098367, 0.8310502283, 0.9714285714, 0.9444444444, 0.01471191306 },
        { 0.02563906322, 0.9846153846, 0.9122807018, 0.01842480862, 0.9390243902, 0.06352667539, 0.9682539683, 0.1885885886, 0.2355625931, 0.975308642, 0.0351475765, 0.09744197393, 0.9279279279, 1, 0.9425287356, 0.0056269653 },
        { 0.01868583162, 1, 0.9141274238, 0.05910717063, 0.9054707853, 0.1116888119, 1, 0.06251843114, 0.3741455078, 0.9710144928, 0.01786367198, 0.08730184778, 0.9174757282, 0.9285714286, 0.8399685699, 0.0124589351 },
        { 0.01704300744, 0.9583333333, 0.8956947847, 0.1515841396, 0.449168207, 0.5153515065, 1, 0.00421605282, 0.8028616852, 0.9887640449, 0.042649451, 0.07476157526, 0.9240506329, 0.9393939394, 0.6261267321, 0.02842712843 },
        { 0.02208643982, 1, 0.8910683012, 0.4803422757, 0.1430525558, 0.8064918851, 0.8733493397, 0.003062991077, 0.9402686482, 0.98, 0.04124381343, 0.07887839932, 0.8914728682, 1, 0.4299506544, 0.07426760322 },
        { 0.02670354806, 1, 0.8790264853, 0.8727431567, 0.06583410422, 0.5174013921, 0.7489483426, 0.001160274703, 0.8906674721, 0.9920634921, 0.04799212261, 0.07806579987, 0.9504950495, 1, 0.4156023473, 0.3301825293 },
        { 0.03994546005, 1, 0.737985338, 0.8655338013, 0.03432018858, 0.1918446602, 0.6027380952, 0.0009698356253, 0.8874635569, 0.9903846154, 0.04503455529, 0.08672993582, 0.8571428571, 1, 0.2864977438, 0.8369730058 },
        { 0.03809756098, 1, 0.6141250178, 1, 0.03445027587, 0.09750340445, 0.4637706494, 0.0002530577815, 0.8827613309, 0.9473684211, 0.04936095196, 0.07537128368, 0.9433962264, 1, 0.3031865585, 0.9672131148 },
        { 0.07891288522, 1, 0.3892712657, 1, 0.03773584906, 0.04934164934, 0.306759326, 0.0003311441029, 0.9132448287, 1, 0.04170410534, 0.08227885701, 0.8843548654, 1, 0.3033344758, 0.9721946375 },
        { 0.1357226792, 1, 0.2649951865, 0.9718309859, 0.03680449209, 0.05859033405, 0.1295080407, 0.0005935724582, 0.8910417934, 0.9272727273, 0.06228895153, 0.2070332481, 0.8666666667, 1, 0.3055425979, 0.9655172414 },
        { 0.1970041527, 1, 0.2119698943, 0.9882352941, 0.03829447536, 0.02200080923, 0.07679624812, 0.0004800768123, 0.8511058752, 0.9090909091, 0.03632555975, 0.4303544864, 0.8646389364, 1, 0.2458119276, 0.9764705882 },
        { 0.3284388702, 1, 0.1706562968, 0.9754098361, 0.04676913632, 0.02427184466, 0.09844622852, 9.325458502e-05, 0.8935756903, 0.847826087, 0.04558034318, 0.636022746, 0.8575735354, 1, 0.2718481968, 0.98046875 },
        { 0.509207409, 1, 0.1553251868, 1, 0.05509590461, 0.01138961633, 0.0628308938, 0.001515784264, 0.8468314322, 0.9047619048, 0.04996382815, 0.7890216211, 0.8338515614, 1, 0.2295419454, 0.9547169811 },
        { 0.3850410771, 1, 0.1463102971, 1, 0.03776914231, 0.009197910983, 0.05120277329, 0.0004828434808, 0.8917385794, 0.9777777778, 0.04453692633, 0.8336378029, 0.7996971057, 1, 0.1899045947, 0.9923954373 },
        { 0.5842977792, 1, 0.08490733015, 1, 0.04072187002, 0.005949691219, 0.0806387048, 0.0005718860803, 0.8649241347, 0.8409090909, 0.0435232911, 0.8058917561, 0.8090495571, 1, 0.1736012629, 0.9752475248 },
        { 0.6689052116, 1, 0.07286670724, 1, 0.04027916635, 0.004831815648, 0.05909882455, 0.001111941206, 0.89363111, 0.9603174603, 0.0838202132, 0.8561399939, 0.7674817854, 1, 0.1265233999, 0.9651741294 },
        { 0.6903230866, 1, 0.0813442584, 1, 0.02687195734, 0.004239494236, 0.07324316123, 0.0005806526536, 0.8857348617, 0.9836065574, 0.1187205189, 0.8408146858, 0.7455898059, 1, 0.1480134374, 0.9842931937 },
        { 0.8089246923, 1, 0.05783379568, 0.990990991, 0.03499970834, 0.003638844667, 0.08845760981, 0.0008357158566, 0.854984326, 0.9251336898, 0.2311820314, 0.8406804025, 0.581947042, 1, 0.1337432939, 0.9281045752 },
        { 0.8558634496, 1, 0.02765687053, 1, 0.03099536667, 0.00252824524, 0.1213233541, 0.001222298985, 0.8564995696, 0.9392857143, 0.5441713868, 0.875, 0.4687266756, 1, 0.1617163412, 0.9761904762 },
        { 0.8827246304, 0.9953051643, 0.01957984347, 0.9813084112, 0.02858151756, 0.009784411277, 0.1307316574, 0.00775220389, 0.8581529582, 0.9370941558, 0.8043394531, 0.8571428571, 0.4126341082, 1, 0.1687152318, 0.9545454545 },
        { 0.9123410621, 1, 0.01771163637, 0.9444444444, 0.0303411448, 0.007305894632, 0.1376379691, 0.03061725968, 0.8486464315, 0.9478627564, 0.9134866937, 0.9166666667, 0.3159220956, 0.9291896145, 0.2122367101, 0.9866666667 },
        { 0.9003931848, 1, 0.01668220523, 1, 0.03961466165, 0.00768721682, 0.1535988945, 0.1796801505, 0.8636806232, 0.9387526453, 0.8789005444, 0.8638894222, 0.2080963023, 0.9906752412, 0.2702802473, 0.9189189189 },
        { 0.9567318757, 1, 0.0161637792, 0.9696969697, 0.03840744624, 0.006480238193, 0.174606778, 0.3814313794, 0.8234117647, 0.9180749449, 0.9135878489, 0.6673329022, 0.2232951866, 0.9471534338, 0.2765050252, 0.9074074074 },
        { 0.951584507, 1, 0.01571277963, 0.9726027397, 0.04339692168, 0.02100139082, 0.1873115037, 0.7115357194, 0.8253386454, 0.8996299038, 1, 0.1973750997, 0.2002610709, 0.6366131757, 0.3518103914, 0.9833333333 },
        { 0.9835025381, 1, 0.02192037796, 1, 0.05878606458, 0.08922172195, 0.2119302295, 0.8540118871, 0.7966728281, 0.8449934, 0.935483871, 0.1230016129, 0.1867877581, 0.04467707262, 0.386068477, 0.9661016949 },
        { 1, 1, 0.03264504361, 0.8846153846, 0.06577126852, 0.1558306189, 0.2203915841, 0.8984632272, 0.8416789396, 0.6377335744, 0.9428571429, 0.09919276235, 0.1525093056, 0.001502838695, 0.4895640551, 0.985915493 },
        { 1, 1, 0.06678318153, 1, 0.06423205492, 0.6243216576, 0.2286462051, 0.9121315193, 0.8263157895, 0.3446716382, 1, 0.07170197723, 0.1456814697, 0.0004561870367, 0.6220552275, 0.9736842105 },
        { 0.9864864865, 1, 0.08273540942, 0.9473684211, 0.07189396478, 0.8658227848, 0.2490969443, 0.9137931034, 0.8351941343, 0.2915898811, 0.9807692308, 0.07005748306, 0.1538377997, 0, 0.7552829386, 0.9796672828 },
        { 0.9793103448, 1, 0.08269724982, 0.8214285714, 0.08334711427, 0.993006993, 0.2368268674, 0.9565217391, 0.6606704824, 0.21046875, 0.9104477612, 0.0941989569, 0.2034950767, 0.0001758782922, 0.8430426391, 0.9618973561 },
        { 0.9735449735, 1, 0.08818558918, 0.975, 0.09214056384, 0.9487179487, 0.3572707937, 0.9642857143, 0.3255125107, 0.2123662473, 0.962962963, 0.2167596776, 0.289715849, 0, 0.8884564268, 0.8062992126 },
        { 0.9953488372, 1, 0.07190551707, 1, 0.129947606, 0.9921875, 0.4750502888, 0.8928571429, 0.1261946074, 0.1811505911, 0.9569892473, 0.6957629818, 0.3173124253, 0.0002681427285, 0.7673130194, 0.5155567686 },
        { 0.9710144928, 1, 0.08223083434, 0.9054054054, 0.2011909058, 1, 0.6471547125, 0.975, 0.08252808107, 0.1830646656, 0.947761194, 0.7610921502, 0.3813878429, 0, 0.6810065985, 0.3018388703 },
        { 0.9821428571, 1, 0.1137440758, 0.9577464789, 0.2907296074, 0.9880952381, 0.851101078, 0.9230769231, 0.06094674556, 0.151412831, 0.8888888889, 0.7045454545, 0.4523904294, 0.0003305785124, 0.421087033, 0.1838217288 },
        { 0.965648855, 1, 0.1450516512, 0.8804347826, 0.6494517881, 1, 0.8751367781, 0.94, 0.07655836702, 0.1285455984, 0.8266666667, 0.8527131783, 0.6031818182, 0.000425737235, 0.1862372325, 0.0536654516 },
        { 0.9583333333, 0.340403338, 0.1505185003, 0.8367346939, 0.8508469002, 0.9308176101, 0.8802843247, 0.9436619718, 0.1632972616, 0.09834943749, 0.8396946565, 0.8064516129, 0.6678834266, 0.0004347389894, 0.1491594743, 0.02482083552 },
        { 0.9727626459, 0.004752376188, 0.3786436209, 0.7777777778, 0.9468242245, 0.3330967169, 0.8715110683, 0.9733333333, 0.4578865891, 0.1045976702, 0.8888888889, 0.8586956522, 0.7268998273, 0.002252849192, 0.113804362, 0.03133022476 },
        { 0.9182879377, 0.001157891351, 0.6352348053, 0.8875, 0.9672131148, 0.04380475594, 0.8538011696, 0.9537037037, 0.7258365468, 0.1012991153, 0.8963414634, 0.9090909091, 0.7986912347, 0.01590677101, 0.1058410686, 0.01779688439 },
        { 0.8647342995, 0.0007865522046, 0.8297258297, 0.7857142857, 0.9333333333, 0.006967654223, 0.828125, 0.936, 0.5689655172, 0.127707304, 0.81, 0.8552631579, 0.8021953897, 0.04023037543, 0.1021299722, 0.04017623451 },
        { 0.9146919431, 0.0002868278527, 0.923819978, 0.8258426966, 0.96875, 0.008057257961, 0.6521236637, 0.9781021898, 0.8196721311, 0.1637246365, 0.8850574713, 0.9655172414, 0.8141385768, 0.06057600926, 0.125409399, 0.04033363355 },
        { 0.8769230769, 0.0003802067198, 0.9314586995, 0.773480663, 0.9841269841, 0.008271954674, 0.2660144774, 0.9718309859, 0.8352941176, 0.2671843073, 0.8252427184, 0.875, 0.8326530612, 0.08087253921, 0.1252356137, 0.04836083771 },
        { 0.8957055215, 0.002827305758, 0.9622641509, 0.8902439024, 0.9461077844, 0.01044486085, 0.1325001882, 0.9685863874, 0.7746478873, 0.3505427296, 0.8125, 0.9459459459, 0.7967377666, 0.1053724261, 0.1298883435, 0.06066406794 },
        { 0.9326923077, 0.01478520829, 0.9104477612, 0.7848837209, 0.890625, 0.004245993699, 0.122209271, 0.9681528662, 0.8046875, 0.3808668378, 0.9255319149, 0.8125, 0.7361995291, 0.1290849673, 0.1541537095, 0.07023355972 },
        { 0.9157894737, 0.02555215298, 0.8857142857, 0.8285714286, 0.8941798942, 0.01989339093, 0.1111763607, 0.9850746269, 0.8741721854, 0.3421236465, 0.9102564103, 0.8095238095, 0.6028713338, 0.166090752, 0.2218330309, 0.1184026007 },
        { 0.8787878788, 0.03068631041, 0.8924731183, 0.7841726619, 0.9356060606, 0.04290586089, 0.128680052, 0.9658119658, 0.7572254335, 0.2559006756, 0.9285714286, 0.8333333333, 0.3543119542, 0.1860126275, 0.2972819932, 0.0808444097 },
        { 0.95, 0.02411048047, 0.9180327869, 0.8474576271, 0.9208633094, 0.1247970198, 0.1692544908, 0.9512195122, 0.7905982906, 0.1963240619, 0.9019607843, 0.8684210526, 0.1849687721, 0.2660215164, 0.3957158274, 0.1023061059 },
        { 0.98, 0.02462912041, 0.8848920863, 0.7608695652, 0.9479166667, 0.3058470765, 0.2671998338, 0.932038835, 0.7894736842, 0.1439206837, 0.8571428571, 0.8085106383, 0.1366100566, 0.2854343932, 0.4578921828, 0.09541410851 },
        { 0.9036144578, 0.01879682006, 0.8287292818, 0.7529411765, 0.8896551724, 0.7262198127, 0.6330097869, 0.954954955, 0.7872340426, 0.09158449507, 0.7878787879, 0.6515151515, 0.1164087077, 0.380077064, 0.5324316651, 0.07070484581 },
        { 0.950617284, 0.01545116998, 0.744966443, 0.8358208955, 0.875862069, 0.9685264664, 0.8617253192, 0.9894736842, 0.7127272727, 0.08833309468, 0.9310344828, 0.75, 0.1071982362, 0.4375176504, 0.6287876476, 0.09175235041 },
        { 0.9473684211, 0.01345930034, 0.756097561, 0.7666666667, 0.8695652174, 0.9787234043, 0.8915662651, 0.962962963, 0.7701149425, 0.07827583509, 0.8529411765, 0.7529411765, 0.1117453461, 0.4534947716, 0.7605877617, 0.0577413241 },
        { 0.896, 0.01364530461, 0.7875, 0.6666666667, 0.8684210526, 0.9660377358, 0.8888888889, 0.9836065574, 0.8076923077, 0.06682216284, 0.8490566038, 0.7457627119, 0.1263661793, 0.5404481238, 0.8014109784, 0.07119773117 },
        { 0.9230769231, 0.01696420706, 0.632183908, 0.585528066, 0.8962655602, 0.9598393574, 0.9545454545, 0.9722222222, 0.7733711048, 0.06393322183, 0.7118644068, 0.7677419355, 0.1513517374, 0.5896049896, 0.8241170677, 0.0535948163 },
        { 0.8837209302, 0.01309356233, 0.7051282051, 0.1332181018, 0.9512195122, 0.9338521401, 0.9824561404, 0.8823529412, 0.7829912023, 0.07243918984, 0.8224299065, 0.7933333333, 0.2059530412, 0.7016504977, 0.8888888889, 0.07405215461 },
        { 0.8969957082, 0.02767626614, 0.7796610169, 0.05693549189, 0.938547486, 0.9175824176, 0.8541666667, 0.9142857143, 0.7074829932, 0.09854421456, 0.7142857143, 0.9020979021, 0.2527895114, 0.7166158537, 0.8271971496, 0.09076477358 },
        { 0.6946640316, 0.02822339314, 0.7075471698, 0.04138827023, 0.9533678756, 0.9270833333, 0.8552631579, 0.9387755102, 0.756302521, 0.1088209519, 0.7906976744, 0.8697916667, 0.300841644, 0.7158049138, 0.7785991921, 0.1310690276 },
        { 0.2594166885, 0.05009923618, 0.868852459, 0.03442206986, 0.9333333333, 0.9487179487, 0.900990099, 0.9264705882, 0.7587548638, 0.1186434872, 0.8051948052, 0.8977272727, 0.2853833632, 0.7592530844, 0.5000756708, 0.1966708075 },
        { 0.06194890346, 0.05372265515, 0.8735632184, 0.04362653129, 0.9101123596, 0.9406779661, 0.8, 0.9117647059, 0.6820512821, 0.148647146, 0.8203883495, 0.8934911243, 0.4308435359, 0.7384615385, 0.2955366073, 0.2617691503 },
        { 0.02202985406, 0.06701520913, 0.8965517241, 0.04256750752, 0.9636363636, 0.8811881188, 0.7202797203, 0.935483871, 0.7785714286, 0.1730555556, 0.7950310559, 0.8802083333, 0.4435638285, 0.7916666667, 0.2029013919, 0.3207885305 },
        { 0.01350980832, 0.06989055966, 0.8301886792, 0.05691161357, 0.9285714286, 0.9384615385, 0.744047619, 0.914893617, 0.7384615385, 0.1793554414, 0.8444444444, 0.9268292683, 0.4226016124, 0.7678571429, 0.1602009534, 0.3994310883 },
        { 0.005782940326, 0.07179979802, 0.8409090909, 0.1820600035, 0.9178082192, 0.9473684211, 0.7435897436, 0.9111111111, 0.7952755906, 0.1698044996, 0.2486938611, 0.8100558659, 0.4567472883, 0.8671328671, 0.1825206078, 0.3483101912 },
        { 0.00563850292, 0.0676504298, 0.9130434783, 0.9251439539, 0.8588235294, 0.9375, 0.8387096774, 0.9185185185, 0.7567567568, 0.1814771651, 0.066891427, 0.635359116, 0.4238267466, 0.8839779006, 0.3203548711, 0.5882827197 },
        { 0.008602584814, 0.06969154648, 0.9428571429, 0.9, 0.8708010336, 0.9352623835, 0.8035087719, 0.9334170854, 0.8604651163, 0.2668227686, 0.03786094668, 0.5225281602, 0.5060644847, 0.8497072219, 0.7560188632, 0.486503652 },
        { 0.02067754362, 0.0646219517, 0.5494273659, 0.6411622276, 0.5965942454, 0.5362318841, 0.8201712655, 0.8624489071, 0.8163396591, 0.6509278835, 0.02907010682, 0.4467099166, 0.7046285492, 0.6127027027, 0.8107167711, 0.1202523815 },
        { 0.1834838024, 0.07326786267, 0.2250894707, 0.2832364609, 0.2226928623, 0.3676955931, 0.8109179353, 0.7181146868, 0.7668974312, 0.9157904361, 0.03848759995, 0.43093559, 0.8269091567, 0.5265243019, 0.8369605655, 0.1139365267 },
        { 0.1270635318, 0.07891075333, 0.1327219675, 0.2288726259, 0.218344686, 0.4172543488, 0.775827314, 0.6789261481, 0.6726834137, 0.8905946546, 0.06775770531, 0.5189902467, 0.8500275482, 0.4424196679, 0.8146409135, 0.1330049261 },
        { 0.1181384248, 0.1121177803, 0.1606017483, 0.1899545267, 0.1937732342, 0.2633501967, 0.6499506417, 0.490063015, 0.4441474126, 0.8037799958, 0.1922666448, 0.5085939701, 0.7548237715, 0.3402815376, 0.8129130656, 0.1717791411 },
    };
    
    return true;
}

void rank_tags(std::vector<std::vector<int>>& tag_freq) {

    int tag_size = tag_freq.size();
    std::vector<std::vector<std::pair<int, int>>> tags;
    for(int j = 1; j < tag_freq[0].size(); ++j) {
        std::vector<std::pair<int, int>> tags_j;
        for(int i = 1; i < tag_size; ++i) {
            tags_j.emplace_back(std::make_pair(i, tag_freq[i][j]));
        }
        std::sort(tags_j.begin(), tags_j.end(), [](const std::pair<int, int>& a, const std::pair<int, int>& b) {
            return a.second < b.second; // 按照频率升序排序
        });
        tags.emplace_back(tags_j);
    }
    rank = std::move(tags);
}


int main(int argc, char const *argv[])
{

    load_tag_request_busy_rate_from_dat(tag_request_busy_rate);
    
    scanf("%d%d%d%d%d%d", &T, &M, &N, &V, &G, &K);

    std::vector<std::vector<int>> tags_delete(M + 1, std::vector<int>((T - 1) / FRE_PER_SLICING + 2));
    std::vector<std::vector<int>> tags_save(M + 1, std::vector<int>((T - 1) / FRE_PER_SLICING + 2));
    std::vector<std::vector<int>> tags_freq(M + 1, std::vector<int>((T - 1) / FRE_PER_SLICING + 2));
    std::vector<int> g(std::ceil((double)(T + 105)/FRE_PER_SLICING) + 1, 0);

    for (int i = 1; i <= M; i++) {
        for (int j = 1; j <= (T - 1) / FRE_PER_SLICING + 1; j++) {
            scanf("%d", &tags_delete[i][j]);
        }
    }
    
    for (int i = 1; i <= M; i++) {
        for (int j = 1; j <= (T - 1) / FRE_PER_SLICING + 1; j++) {
            scanf("%d", &tags_save[i][j]);
        }
    }
    
    for (int i = 1; i <= M; i++) {
        for (int j = 1; j <= (T - 1) / FRE_PER_SLICING + 1; j++) {
            scanf("%d", &tags_freq[i][j]);
        }
    }

    for(int i = 1; i < g.size(); ++i) {
        scanf("%d", &g[i]);
    }


    initialize_action(tags_delete, tags_save, tags_freq, disk_list, M, N, T, V, disk_rank);
    printf("OK\n");
    fflush(stdout);
    
    rank_tags(tags_freq);

    for (int t = 1; t <= T + EXTRA_TIME; t++) {

        timestamp_action();
        delete_action(t, heatmap);
        write_action(t);
        read_action(t, heatmap, object_list, fake_heatmap, disk_list, request_object, rank, g);

        if(t % 1800 == 0) {
            gc_action(disk_list, object_list, t, rank, K, heatmap);
        }
    }

    heatmap.caculate_tag_request_busy_rate_and_save();

    return 0;
}
